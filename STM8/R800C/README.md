# مستندات راه‌اندازی و ارسال پیامک با مودم GSM

## فهرست مطالب
- [مقدمه](#مقدمه)
- [مراحل راه‌اندازی اولیه (Initialization)](#مراحل-راه‌اندازی-اولیه-initialization)
- [مراحل ارسال پیامک (SMS Send)](#مراحل-ارسال-پیامک-sms-send)
- [نمونه لاگ کامل](#نمونه-لاگ-کامل)
- [توضیحات تکمیلی](#توضیحات-تکمیلی)

---

## مقدمه

این مستندات مربوط به ارتباط با مودم‌های GSM/GPRS (مانند SIM800، SIM900، R800C و...) از طریق دستورات AT است. دو عملیات اصلی در این مستند پوشش داده شده است:

1. **راه‌اندازی اولیه مودم** (AT Commands for Module Initialization)
2. **ارسال پیامک به زبان فارسی** (Sending Persian/Unicode SMS)

---

## مراحل راه‌اندازی اولیه (Initialization)

### 1. همگام‌سازی با مودم (AT Sync)
```at
AT
```
**پاسخ موفق:** `OK`

این دستور برای بررسی ارتباط با مودم استفاده می‌شود. اگر مودم پاسخ ندهد، عملیات راه‌اندازی شکست می‌خورد.

### 2. تنظیم فرمت پاسخگویی
```at
ATV1
```
**پاسخ:** `OK`

تنظیم فرمت پاسخگویی مودم به حالت متنی (Verbose) به جای حالت عددی.

### 3. فعال‌سازی اکو
```at
ATE1
```
**پاسخ:** `OK`

فعال‌سازی تکرار دستورات در خروجی برای سهولت در دیباگ و عیب‌یابی.

### 4. فعال‌سازی گزارش خطای پیشرفته
```at
AT+CMEE=2
```
**پاسخ:** `OK`

فعال‌سازی نمایش خطاها به صورت متنی و قابل فهم.

### 5. بررسی و تنظیم نرخ باود (Baudrate)
```at
AT+IPR?
```
**پاسخ نمونه:** `+IPR: 115200`

بررسی سرعت ارتباط سریال بین مودم و میکروکنترلر/کامپیوتر.

### 6. دریافت اطلاعات مودم
```at
ATI
```
**پاسخ نمونه:**
```
R800C R1850
OK
```

دریافت اطلاعاتی شامل:
- مدل مودم (R800C)
- نسخه فریمور (R1850)

### 7. دریافت شماره IMEI
```at
AT+GSN
```
**پاسخ نمونه:** `863070040316472`

دریافت شماره سریال یکتای سخت‌افزار (IMEI).

### 8. بررسی وضعیت سیم‌کارت
```at
AT+CPIN?
```
**پاسخ نمونه:** `+CPIN: READY`

بررسی موارد زیر:
- وجود سیم‌کارت در اسلات
- نیاز یا عدم نیاز به رمز PIN
- آماده بودن سیم‌کارت برای عملیات شبکه

---

## مراحل ارسال پیامک (SMS Send)

### 1. فعال‌سازی حالت متنی پیامک
```at
AT+CMGF=1
```
**پاسخ:** `OK`

تنظیم مودم برای کار با پیامک‌های متنی ساده (Text Mode).

### 2. تنظیم پارامترهای پیامک
```at
AT+CSMP=17,167,0,8
```
**پاسخ:** `OK`

تنظیم مشخصات پیامک:
- **17:** مدت اعتبار پیام (Validity Period)
- **167:** تنظیمات گزارش تحویل و نوع پیام
- **0:** بایت اضافی (معمولاً صفر)
- **8:** فعال‌سازی حالت UCS2 برای پشتیبانی از زبان فارسی

### 3. تنظیم نوع کاراکتر
```at
AT+CSCS="UCS2"
```
**پاسخ:** `OK`

تنظیم مودم برای دریافت کاراکترهای Unicode 16-bit (پشتیبانی از فارسی، عربی، چینی و...).

### 4. ارسال پیامک
```at
AT+CMGS="002B003900380039003900310038003500350035003300380034"
```
**پاسخ مودم:** `>`

شماره گیرنده به صورت UCS2 هگزادسیمال:
- `002B` = +
- `0039` = 9
- ...
- معادل: **+989918555384**

### 5. وارد کردن متن پیام
```
0633064406270645
```
**پاسخ موفق:** 
```
+CMGS: 34
OK
```

متن پیام به صورت UCS2:
- `0633` = س
- `0644` = ل
- `0627` = ا
- `0645` = م
- **معادل: "سلام"**

علامت `` (CTRL+Z) نشان‌دهنده پایان پیام است.

---

## نمونه لاگ کامل

### راه‌اندازی اولیه
```log
[2026-02-22 06:02:36:154_S:] AT
[2026-02-22 06:02:36:161_R:] OK

[2026-02-22 06:02:36:170_S:] ATV1
[2026-02-22 06:02:36:177_R:] OK

[2026-02-22 06:02:36:186_S:] ATE1
[2026-02-22 06:02:36:194_R:] OK

[2026-02-22 06:02:36:201_S:] AT+CMEE=2
[2026-02-22 06:02:36:210_R:] OK

[2026-02-22 06:02:36:217_S:] AT+IPR?
[2026-02-22 06:02:36:226_R:] +IPR: 115200

[2026-02-22 06:02:36:237_S:] ATI
[2026-02-22 06:02:36:247_R:] R800C R1850

[2026-02-22 06:02:36:269_S:] AT+GSN
[2026-02-22 06:02:36:278_R:] 863070040316472

[2026-02-22 06:02:36:349_S:] AT+CPIN?
[2026-02-22 06:02:36:373_R:] +CPIN: READY
```

### ارسال پیامک
```log
[2026-02-22 05:55:31:925_S:] AT+CMGF=1
[2026-02-22 05:55:31:934_R:] OK

[2026-02-22 05:55:31:935_S:] AT+CSMP=17,167,0,8
[2026-02-22 05:55:31:948_R:] OK

[2026-02-22 05:55:31:949_S:] AT+CSCS="UCS2"
[2026-02-22 05:55:31:958_R:] OK

[2026-02-22 05:55:31:961_S:] AT+CMGS="002B003900380039003900310038003500350035003300380034"
[2026-02-22 05:55:31:976_R:] > 0633064406270645
[2026-02-22 05:55:34:493_R:] +CMGS: 34
[2026-02-22 05:55:34:493_R:] OK
```

---

## توضیحات تکمیلی

### نکات مهم در ارسال پیامک فارسی
1. **تبدیل متن به UCS2:**
   - هر کاراکتر فارسی به ۴ کاراکتر هگزادسیمال تبدیل می‌شود
   - مثال: "سلام" → `0633064406270645`

2. **تبدیل شماره تلفن به UCS2:**
   - شماره باید با + شروع شود
   - مثال: +9891... → `002B0039003800390031...`

3. **پایان پیام:**
   - حتماً از `` (CTRL+Z) در پایان استفاده شود
   - برای لغو ارسال می‌توان از `ESC` استفاده کرد

### عیب‌یابی رایج
- **خطا در ارسال:** بررسی کنید که اعتبار سیم‌کارت کافی باشد
- **عدم پشتیبانی از فارسی:** مطمئن شوید AT+CSCS="UCS2" اجرا شده است
- **عدم دریافت پاسخ:** نرخ باود را بررسی کنید

---

## منابع مفید
- [مستندات کامل دستورات AT](https://www.atcommands.org/)
- [جدول تبدیل یونیکد به UCS2](https://www.unicode.org/charts/)
- [راهنمای مودم‌های SIM800](https://www.simcom.com/product/SIM800.html)